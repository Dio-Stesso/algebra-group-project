@page "/first-group"
@using System.Threading.Tasks
@using System.Runtime.InteropServices

<h1>Blazor App with wasm module</h1>

<p>Enter two numbers to add:</p>
<input type="text" @bind-value="@number1" />
<input type="text" @bind-value="@number2" />
<button @onclick="AddNumbers">Add</button>

@if (!string.IsNullOrEmpty(result))
{
    <p>The sum is @result</p>
}

@code {
    private string number1;
    private string number2;
    private string result;

    [DllImport("addition")]
    private static extern IntPtr addition(string a, string b);

    private async Task AddNumbers()
    {
        var a = Marshal.StringToHGlobalAnsi(number1);
        var b = Marshal.StringToHGlobalAnsi(number2);

        try
        {
            var resultPtr = addition(Marshal.PtrToStringAnsi(a), Marshal.PtrToStringAnsi(b));
            result = Marshal.PtrToStringAnsi(resultPtr);
        }
        finally
        {
            Marshal.FreeHGlobal(a);
            Marshal.FreeHGlobal(b);
        }
    }
}
